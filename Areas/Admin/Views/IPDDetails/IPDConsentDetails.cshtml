@model List<HMSCore.Areas.Admin.Models.IPDConsentForm>

@{
    ViewData["Title"] = "IPD Consent Forms";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<section class="content-header">
    <h1>IPD Consent Forms</h1>
    <ol class="breadcrumb">
        <li><a href="/Admin/Dashboard"><i class="fa fa-home"></i> Home</a></li>
        <li class="active">IPD Consent Forms</li>
    </ol>
</section>

<section class="content">

        <div class="box">
            <div class="box-header with-border">
                <div class="pull-left">
                <a href="/Admin/IPDDetails/IPDConsentForms" class="btn btn-danger btn-flat">
                    <i class="fa fa-plus"></i> IPD Consent Forms
                    </a>

                <form method="post" asp-action="DeleteConsentSelectedPlan" id="deleteForm" style="display:inline-block;">
                        <div id="hiddenInputsContainer"></div>
                        <button type="submit" class="btn btn-primary btn-flat" style="margin-left:10px;">Delete Selected</button>
                    </form>
                </div>


                <div class="pull-right">
                <form method="get" asp-action="IPDConsentDetails" class="form-inline mb-3">

                        <!-- Page Size -->
                        <select id="pageSizeSelect" class="form-control input-sm">
                            <option value="20">20</option>
                            <option value="30">30</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>

                        <select name="status"
                                class="form-control input-sm"
                                style="width:130px;">
                            <option value="">-- Status --</option>
                            <option value="PatientId">PatientId</option>
                            <option value="TaskName">TaskName</option>
                            <option value="Status">Status</option>

                        </select>
                        <input type="text"
                               name="search"
                               value="@Context.Request.Query["search"]"
                               class="form-control input-sm"
                               style="width:120px;" />

                        <button type="submit" class="btn btn-primary btn-sm">
                            Search
                        </button>

                        <a asp-action="IPDConsentDetails"
                           class="btn btn-default btn-sm">
                            Show All
                        </a>

                    </form>

                </div>
            </div>
            <!-- Date Filter -->

        <div class="box-body table-responsive">
            <table class="table table-bordered table-striped table-hover">
                <thead>
                    <tr>
                        <th width="40px">
                            <input type="checkbox" id="chkAll" onclick="toggleAll(this)" />
                        </th>
                        <th>Patient ID</th>
                        <th>Consent Type</th>
                        <th>Consent Date</th>
                        <th>Taken By</th>
                        <th>Document</th>
                        <th width="120px">Action</th>
                    </tr>
                </thead>

                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var row in Model)
                        {
                            <tr>
                                <td>
                                    <input type="checkbox"
                                           class="chkSelect"
                                           value="@row.ConsentId" />
                                </td>

                                <td>@row.PatientId</td>

                                <td>
                                    @(string.IsNullOrEmpty(row.ConsentType)
                                      ? "-"
                                : row.ConsentType)
                                    </td>

                                <td>
                                    @(row.ConsentDate.HasValue
                                                                ? row.ConsentDate.Value.ToString("dd-MM-yyyy")
                                  : "-")
                                                                  </td>

                                <td>
                                    @(string.IsNullOrEmpty(row.TakenBy)
                                                                ? "-"
                                 : row.TakenBy)
                        </td>

                                <td>
                            @if (!string.IsNullOrEmpty(row.UploadedFilePath))
                                    {
                                        <a href="~/@row.UploadedFilePath"
                                           target="_blank"
                                           class="btn btn-xs btn-info">
                                            <i class="fa fa-file"></i> View
                                        </a>
                                    }
                                    else
                                    {
                                        <span>-</span>
                                    }
                                </td>

                                <td>
                                    <a asp-action="Create"
                                       asp-route-id="@row.ConsentId"
                                       class="btn btn-warning btn-sm">
                                        <i class="fa fa-edit"></i>
                                    </a>

                                    <form method="post"
                                          asp-action="DeleteConsentForms"
                                          asp-route-id="@row.ConsentId"
                                          style="display:inline;"
                                          onsubmit="return confirm('Are you sure to delete this record?');">
                                        <button type="submit"
                                                class="btn btn-danger btn-sm">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="7"
                                class="text-center text-danger">
                                No Records Found
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        function toggleAll(source) {
            let checkboxes = document.querySelectorAll('.chkSelect');
            checkboxes.forEach(cb => cb.checked = source.checked);
        }
    </script>
}
